{{ $schema := dict "@context" "https://schema.org" "@type" "WebPage" "name" .Title "description" (.Description | default .Summary) }}

{{ if .IsPage }}
  {{ $schema = dict "@context" "https://schema.org" "@type" "Article" "headline" .Title "description" (.Description | default .Summary) "author" (dict "@type" "Person" "name" (.Params.author | default .Site.Params.author)) "datePublished" (.Date.Format "2006-01-02T15:04:05-07:00") "dateModified" (.Lastmod.Format "2006-01-02T15:04:05-07:00") }}
{{ end }}

{{/* Only add image if we have one */}}
{{ $hasImage := false }}
{{ with .Params.images }}
  {{ if and (len .) (index . 0) }}
    {{ $schema = merge $schema (dict "image" (index . 0)) }}
    {{ $hasImage = true }}
  {{ end }}
{{ end }}
{{ if not $hasImage }}
  {{ with .Site.Params.images }}
    {{ if and (len .) (index . 0) }}
      {{ $schema = merge $schema (dict "image" (index . 0)) }}
    {{ end }}
  {{ end }}
{{ end }}

<script type="application/ld+json">
  {{ $schema | jsonify | safeJS }}
</script> 